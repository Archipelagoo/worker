<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Absen Archipelago - Professional</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Poppins', sans-serif; }
    :root { --bg-primary: #0a1628; --bg-header: #1a2d4a; --pink-bold: #ff1493; --orange: #ff8c00; }
    body { background-color: var(--bg-primary); color: white; margin: 0; height: 100%; overflow-x: hidden; }
    
    /* Utility Styles */
    .page { display: none; min-height: 100vh; flex-direction: column; }
    .page.active { display: flex; }
    .bg-header { background-color: var(--bg-header); }
    
    /* Card & Components */
    .card-worker { background: #1e293b; border-radius: 12px; padding: 12px; transition: 0.3s; cursor: pointer; border: 2px solid transparent; }
    .card-worker.selected { border-color: var(--pink-bold); background: #2d3748; box-shadow: 0 0 15px rgba(255, 20, 147, 0.3); }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--orange); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Photo Gallery */
    .photo-card { position: relative; border-radius: 8px; overflow: hidden; background: #1e293b; aspect-ratio: 1/1; }
    .photo-card img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; }
    
    .fullscreen-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; }
    .fullscreen-overlay.active { display: flex; }
  </style>
</head>
<body>

  <div id="notification" class="fixed top-4 left-1/2 -translate-x-1/2 z-[100] hidden">
    <div class="bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-2">
      <span id="notif-msg">Berhasil disimpan!</span>
    </div>
  </div>

  <header id="main-header" class="hidden bg-header p-4 sticky top-0 z-40 shadow-lg border-b border-slate-700">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div>
        <h1 class="text-lg font-bold">ABSEN ARCHIPELAGO</h1>
        <p id="header-date" class="text-xs text-slate-400"></p>
      </div>
      <div class="text-right">
        <div id="header-time" class="text-orange-400 font-bold text-xl">00:00:00</div>
      </div>
    </div>
  </header>

  <div id="page-login" class="page active items-center justify-center p-6">
    <div class="bg-white text-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-md">
      <div class="text-center mb-8">
        <div class="text-5xl mb-2">üè¢</div>
        <h2 class="text-2xl font-bold">Welcome Back</h2>
        <p class="text-slate-500 text-sm">Silakan login untuk akses absen</p>
      </div>
      <form onsubmit="handleLogin(event)" class="space-y-4">
        <input type="text" id="username" placeholder="Username" class="w-full p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-orange-500" required>
        <input type="password" id="password" placeholder="Password" class="w-full p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-orange-500" required>
        <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold hover:bg-orange-600 transition">LOGIN</button>
      </form>
    </div>
  </div>

  <div id="page-attendance" class="page p-4">
    <div class="max-w-5xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">Daftar Pekerja</h2>
        <div class="flex gap-2">
          <button onclick="showPage('page-recap')" class="bg-slate-700 p-2 rounded-lg text-sm">üìä Rekap</button>
          <button onclick="logout()" class="bg-red-900/50 p-2 rounded-lg text-sm">Logout</button>
        </div>
      </div>
      
      <div id="workers-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-20">
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-header border-t border-slate-700">
      <div class="max-w-5xl mx-auto flex items-center gap-4">
        <div class="flex-1">
          <label class="block text-[10px] text-slate-400">Bukti Foto (Max 1)</label>
          <input type="file" id="photo-input" accept="image/*" capture="environment" class="text-xs">
        </div>
        <button onclick="submitAttendance()" id="btn-submit" class="bg-green-600 px-8 py-3 rounded-xl font-bold shadow-lg">KIRIM ABSEN</button>
      </div>
    </div>
  </div>

  <div id="page-recap" class="page p-4">
    <div class="max-w-4xl mx-auto">
      <button onclick="showPage('page-attendance')" class="mb-6 text-slate-400">‚Üê Kembali</button>
      <h2 class="text-2xl font-bold mb-6">Menu Rekapitulasi</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div onclick="showPage('page-photo-gallery')" class="bg-slate-800 p-6 rounded-2xl cursor-pointer hover:bg-slate-700 border border-slate-700">
          <div class="text-3xl mb-2">üì∏</div>
          <h3 class="font-bold">Galeri Foto</h3>
          <p class="text-xs text-slate-400">Lihat bukti foto kehadiran harian</p>
        </div>
        <div onclick="alert('Fitur Laporan Bulanan segera hadir')" class="bg-slate-800 p-6 rounded-2xl cursor-pointer hover:bg-slate-700 border border-slate-700 opacity-50">
          <div class="text-3xl mb-2">üìë</div>
          <h3 class="font-bold">Laporan PDF</h3>
          <p class="text-xs text-slate-400">Generate laporan bulanan otomatis</p>
        </div>
      </div>
    </div>
  </div>

  <div id="page-photo-gallery" class="page p-4">
    <div class="max-w-5xl mx-auto">
      <button onclick="showPage('page-recap')" class="mb-6 text-slate-400">‚Üê Kembali</button>
      <h2 class="text-xl font-bold mb-4">Folder Foto</h2>
      <div id="folder-list" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        </div>
      <div id="gallery-loader" class="hidden justify-center py-10"><div class="loader"></div></div>
    </div>
  </div>

  <div id="fullscreen-viewer" class="fullscreen-overlay" onclick="this.classList.remove('active')">
    <img id="fullscreen-img" src="" class="max-w-[90%] max-h-[90%] shadow-2xl border-4 border-white rounded-lg">
  </div>

  <script>
    // --- CONFIGURATION ---
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx0Q1bSCEtivbGe1d8W40y6M0s_knNDxvZefBAn9UKN0SiCjpL98Xz_1ClCtuhI7xVseg/exec';
    
    // --- STATE MANAGEMENT ---
    let workers = ["Budi", "Siti", "Agus", "Iwan", "Dewi", "Rian", "Eko", "Ani"]; // Contoh Data
    let selectedWorkers = new Set();

    // --- NAVIGATION ---
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      const header = document.getElementById('main-header');
      if (pageId === 'page-login') header.classList.add('hidden');
      else header.classList.remove('hidden');

      if (pageId === 'page-attendance') renderWorkers();
      if (pageId === 'page-photo-gallery') loadFolders();
    }

    // --- LOGIN LOGIC ---
    function handleLogin(e) {
      e.preventDefault();
      // Simple Login logic
      showPage('page-attendance');
      showNotif("Login Berhasil!");
    }

    function logout() {
      showPage('page-login');
    }

    // --- ATTENDANCE LOGIC ---
    function renderWorkers() {
      const grid = document.getElementById('workers-grid');
      grid.innerHTML = workers.map(name => `
        <div class="card-worker ${selectedWorkers.has(name) ? 'selected' : ''}" onclick="toggleWorker('${name}')">
          <div class="w-12 h-12 bg-slate-700 rounded-full mb-2 flex items-center justify-center font-bold">
            ${name.charAt(0)}
          </div>
          <div class="font-medium text-sm">${name}</div>
          <div class="text-[10px] ${selectedWorkers.has(name) ? 'text-green-400' : 'text-slate-500'}">
            ${selectedWorkers.has(name) ? '‚óè HADIR' : '‚óã ABSEN'}
          </div>
        </div>
      `).join('');
    }

    function toggleWorker(name) {
      if (selectedWorkers.has(name)) selectedWorkers.delete(name);
      else selectedWorkers.add(name);
      renderWorkers();
    }

    async function submitAttendance() {
      if (selectedWorkers.size === 0) return alert("Pilih minimal 1 pekerja!");
      
      const btn = document.getElementById('btn-submit');
      btn.innerText = "MENGIRIM...";
      btn.disabled = true;

      // Logika simulasi kirim data
      setTimeout(() => {
        showNotif(`Berhasil absen ${selectedWorkers.size} orang`);
        selectedWorkers.clear();
        renderWorkers();
        btn.innerText = "KIRIM ABSEN";
        btn.disabled = false;
      }, 2000);
    }

    // --- GALLERY LOGIC ---
    async function loadFolders() {
      const container = document.getElementById('folder-list');
      const loader = document.getElementById('gallery-loader');
      container.innerHTML = '';
      loader.classList.replace('hidden', 'flex');

      try {
        const resp = await fetch(`${SCRIPT_URL}?action=getPhotoFolders`);
        const data = await resp.json();
        if (data.folders) {
          data.folders.forEach(folder => {
            const div = document.createElement('div');
            div.className = "bg-slate-800 p-4 rounded-xl text-center cursor-pointer border border-slate-700 hover:border-orange-500";
            div.innerHTML = `<div class="text-2xl mb-1">üìÅ</div><div class="text-xs font-bold">${folder}</div>`;
            div.onclick = () => alert("Membuka folder: " + folder);
            container.appendChild(div);
          });
        }
      } catch (e) {
        container.innerHTML = `<p class="text-red-400 text-xs">Gagal memuat folder</p>`;
      } finally {
        loader.classList.replace('flex', 'hidden');
      }
    }

    // --- UI HELPERS ---
    function showNotif(msg) {
      const el = document.getElementById('notification');
      document.getElementById('notif-msg').innerText = msg;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 3000);
    }

    // --- CLOCK ---
    setInterval(() => {
      const now = new Date();
      document.getElementById('header-time').innerText = now.toLocaleTimeString('id-ID');
      document.getElementById('header-date').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }, 1000);

  </script>
</body>
</html>
